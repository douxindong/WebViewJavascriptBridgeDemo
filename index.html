<html>

<head>
    <meta charset="utf-8" />
    <title>demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="http://m.lifetest.com/test/jquery-1.11.0.min.js"></script>
    <script src="demo.js"></script>
    <style>
        .prcimage{
            width: 100px;
            height: 100px;
            -webkit-touch-callout:default !important;
        }
    </style>
</head>

<body>
    <div>demo 001-limery4</div>
    <img class="prcimage" src="https://i1.lifevccdn.com//upload/AppItemHeaders/8395006666be41d5bfaf348ac0d2668e.jpg"  alt="">
    <div class="content">

        <div>
            购物车<br /><span id="addcartresulttxt"></span> <br />
            <input id="addcarttxt"  placeholder="商品id" value="23187" style="
            width: 100%;
            line-height: 28px;
        "/><br />
            <button id="addcartbtn" type="button">加入购物车</button>
        </div><br />

        <div>
            登录<br />
            <span id="sitxt"></span> <br />
            <button id="loginbtn" type="button">点击登录</button>
            <br /><br />
            <button id="getuserinfobtn" type="button">获取用户信息</button>
            <span id="userinfotxt"></span> <br />
        </div><br />

        <div>
            礼品券<br /><span id="addgiftcouponresulttxt"></span> <br />
            <input id="addgiftcoupontxt"  placeholder="参数" value='{"itemid":"34260","code":"1192LYTEST0113","promotionid":"1192"}' style="
            width: 100%;
            line-height: 28px;
        "/><br />
            <button id="addgiftcouponbtn" type="button">添加礼品券</button>
        </div><br />
        <div>
            体验券<br /><span id="addexperiencecouponresulttxt"></span> <br />
            <input id="addexperiencecoupontxt"  placeholder="参数" value='{"itemid":"36125","code":"1193LYTEST0113","promotionid":"1193"}' style="
            width: 100%;
            line-height: 28px;
        "/><br />
            <button id="addexperiencecouponbtn" type="button">添加体验券</button>
        </div><br />
        <div>
            相册<br /><br />
            <button id="openalbumbtn" type="button">打开相册选择图片</button><br /><br />
            <img id="albumimg" style="display: block;width: 200px;height: 200px;background: aqua"/><br /><br />
            <button id="saveimgtoalbumbtn" type="button">保存图片至相册</button>

        </div><br />

        <div>
            提醒<br /><br />
            <span id="noticetxt"></span> <br />
            <button id="noticebtn" type="button">点击开启或关闭</button>
        </div><br />

        <div>
            标题<br /><br />
            <button id="settitlebtn" type="button">更新title</button>
        </div><br />

        <div>
			<span id="sharetxt"></span> <br />

            h5分享<br />
            <button id="h5sharebtn" type="button">打开h5分享</button>
			<br /><br />
			全部分享<br />

            <button id="sharebtn" type="button">打开全部分享</button>



            <div style="background: aqua">
            <ul>
                <li>
                    <div>分享H5链接（目前支持QQ、微信好友、朋友圈）</div>
                    <button id="h5sharebtn1" type="button">朋友圈</button>
                    <button id="h5sharebtn2" type="button">微信好友</button>
                    <button id="h5sharebtn3" type="button">QQ</button>
                </li>
                <li>
                    <div>分享海报（目前支持朋友圈，添加支持微信好友和QQ）</div>
                    <button id="imgsharebtn1" type="button">朋友圈</button>
                    <button id="imgsharebtn2" type="button">微信好友</button>
                    <button id="imgsharebtn3" type="button">QQ</button>
                </li>
                <li>
                    <div>分享小程序（目前支持微信好友）</div>
                    <button id="minsharebtn" type="button">微信好友</button>
                </li>
            </ul>
            </div>
        </div><br />



        <div>
            支付<br />
            <span id="payresult"></span><br />
            <button id="createpaydatabtn" type="button">生成支付信息</button><br /><br />
            <textarea id="wxpaytxt" rows="10" cols="50" placeholder="微信支付data">
            </textarea><br /><br />
            <button id="wxpaybtn" type="button">微信支付</button><br /><br />
            <textarea id="alipaytxt" rows="10" cols="50" placeholder="支付宝支付data">
                </textarea><br /><br />
            <button id="alipaybtn" type="button">支付宝支付</button>
        </div><br />

        <div>
            webview<br /><br />
            <button id="refreshbtn" type="button">刷新webview</button>
            <button id="refreshbtn1" type="button">刷新webview1</button>
        </div><br />

        <div>
            打开原生页面<br />
            <a href="usercenter/toshoppingcart">购物车</a><br />
            <a href="inner:///item/23532">详情页</a><br />
            <a href="www.lifevc.com/item/25292">详情页</a><br />
            <a href="http://m.lifevc.com/activity/oneyearwashtwo">49元</a><br />
            <a href="usercenter/coupon">优惠券</a><br />
            <a href="usercenter/giftcoupon">礼品券</a><br />
            <a href="usercenter/experiencecoupon">体验券</a><br />
            <a href="usercenter/integral">积分</a><br />
        </div><br />

        <div>
            <a href="http://m.lifetest.com/test/test-app/index.html?r=1" id="next">下一页</a>
        </div>
        <br /><br />
    </div>
    <div id="log"></div>



    <script>

        window.onerror = function(err) {
            log('window.onerror: ' + err)
        };
        //呼出相册，选完照片后回调方法
        function callAlbumCallback(imgbase64str) {
            alert('callAlbumCallback')
            log(imgbase64str)
            //var imgbase64str="test";
            log("begin callAlbumCallback ");
            try {
                $("#albumimg").attr("src", "data:image/jpeg;base64," + imgbase64str);
                alert('callAlbumCallback success')
            } catch (error) {
                alert('callAlbumCallback error'+ error)
            }
        }

        //保存照片后回调方法
        function savePhotoToAlbumCallback(result) {

            // setTimeout(function () {
                log("begin savePhotoToAlbumCallback " + result);
                try {
                    if (toBoolean(result)) {
                        alert("保存成功");
                    } else {
                        alert("保存失败");
                    }
                } catch (error) {
                    log("callAlbumCallback error");
                    log(error);
                }
            // }, 100);


        }
        //保存照片后回调方法
        function cartNumCallback(result) {
        	log("begin cartNumCallback " + result);
                try {
                    if (result) {
                        alert(result);
                    } else {
                        alert(result);
                    }
                } catch (error) {
                    log("cartNumCallback error");
                    log(error);
                }

        }
        //原生支付后回调的方法
        function PayCallBack(status) {
            log("begin PayCallBack " + status);
            alert('PayCallBack='+status);
            log(status);
            if (status.toLowerCase()=="true") {
                $("#payresult").text('支付成功');
                alert('支付成功');

            } else {
                $("#payresult").text('支付失败');
                alert('支付失败');
            }
        }
        //原生app分享到微信后，用户从微信转回app时原生回调的js方法
        function shareResult(status) {
            log("原生调用了页面的分享回调方法status=" + status);
            if (status == 1) {
                //ToDo
            }
        }
        function toBoolean(status) {
            if (typeof(status) === 'string'){
                return (status.toLowerCase() === 'true' || status === '1');
            }
            return status;
        }
        //弹出去设置开启提醒的alert
        function showEnableAppNoticeAlertCallback(result) {
            log("begin showEnableAppNoticeAlertCallback ");
            try {
                // alert("result:"+result)
                // alert("resultType:"+typeof(result))
                if (toBoolean(result)) {
                    // alert("已开启");
                    $("#noticetxt").text("已开启");
                } else {
                    // alert("未开启");
                    $("#noticetxt").text("未开启");
                    //去设置通知
                    // $("#noticebtn").unbind("click");
                }
            } catch (error) {
                log("showEnableAppNoticeAlertCallback error");
            }
        }
        //原生app打开本页连接后回调的js方法
        function initializeAsyn(si) {
            log("begin initializeAsyn " + si);
            try {
                //ToDo
                ustr = si;
                $("#sitxt").text(si);
                log("demo si=" + si);
                log("demo l=" + ustr.toString().length);

            } catch (error) {
                log("initializeAsyn error");
                log(error);
            }
        }
        //调用原生获取用户信息方法后，原生回调的js方法
        function userInfoCallback(json) {
            log("begin userInfoCallback " + JSON.stringify(json));
            try {
                //ToDo
                $("#userinfotxt").text(JSON.stringify(json));

            } catch (error) {
                log("userInfoCallback error");
                log(error);
            }
        }
        //调用原生加入购物车方法后，原生回调的js方法
        function addCartCallback(result) {
            log("begin addCartCallback " + result);
            try {
                //ToDo
                $("#addcartresulttxt").text("加入购物车："+result)

            } catch (error) {
                log("addCartCallback error");
                log(error);
            }
        }

        //调用原生使用礼品券方法后，原生回调的js方法
        function addGiftCouponCallback(result) {
            log("begin addGiftCouponCallback " + result);
            try {
                //ToDo
                $("#addgiftcouponresulttxt").text("礼品券加入购物车："+result)

            } catch (error) {
                log("addGiftCouponCallback error");
                log(error);
            }
        }

        //调用原生使用礼品券方法后，原生回调的js方法
        function addExperienceCouponCallback(result) {
            log("begin addExperienceCouponCallback " + result);
            try {
                //ToDo
                $("#addexperiencecouponresulttxt" +
                    "").text("体验券加入购物车："+result)

            } catch (error) {
                log("addExperienceCouponCallback error");
                log(error);
            }
        }
    </script>
    <script>
        $(function () {
            setInnerTitle('列表1111');
            //购物车-----------------------------------------------------------------------------------
            $("#addcartbtn").click(function () {
                log($(this).text() + " click");
                var id=$("#addcarttxt").val();
                addCart(id);
                log($(this).text() + " stop");
            });
            //购物车-------------------------------------------------------------------------------

            //礼品券-----------------------------------------------------------------------------------
            $("#addgiftcouponbtn").click(function () {
                log($(this).text() + " click");
                var data=$("#addgiftcoupontxt").val();
                if(!data||data=="") {alert("参数为空"); return; }
                data=JSON.parse(data);
                addGiftCoupon(data.itemid,data.code,data.promotionid);
                log($(this).text() + " stop");
            });

            $("#addexperiencecouponbtn").click(function () {
                log($(this).text() + " click");
                var data=$("#addexperiencecoupontxt").val();
                if(!data||data=="") {alert("参数为空"); return; }
                data=JSON.parse(data);
                addExperienceCoupon(data.itemid,data.code,data.promotionid);
                log($(this).text() + " stop");
            });
            //礼品券-------------------------------------------------------------------------------

            //相册-------------------------------------------------------------------------
            //打开相册选择图片
            $("#openalbumbtn").click(function () {
                log($(this).text() + " click");
                callAlbum();
                log($(this).text() + " stop");
            });
            //保存图片
            $("#saveimgtoalbumbtn").click(function () {
                log($(this).text() + " click");
                var imgbase64str = $("#albumimg").attr("src");
                if (!imgbase64str || imgbase64str == "") {
                    alert("请先选择图片");
                    return;
                }
                savePhotoToAlbum(imgbase64str.replace("data:image/jpeg;base64,", ""));
                log($(this).text() + " stop");
            });
            //相册--------------------------------------------------------------------------

            //提醒------------------------------------------------------------------------------
            var result = IsEnableAppNotice() || false;
            if (result) {
                $("#noticetxt").text("已开启");
            } else {
                $("#noticetxt").text("未开启");
                //去设置通知
                $("#noticebtn").click(function () {
                    showEnableAppNoticeAlert();
                });
            }
            //提醒------------------------------------------------------------------------------


            //标题------------------------------------------------------------------------------------
            $("#settitlebtn").click(function () {
                log($(this).text() + " click");
                setInnerTitle("更新title");
                log($(this).text() + " stop");
            });
            //标题-------------------------------------------------------------------------------

            //刷新webview------------------------------------------------------------------------------------
            $("#refreshbtn").click(function () {
                log($(this).text() + " click");
                reloadWebView();
                // window.location.reload(true);
                log($(this).text() + " stop");
            });
            //刷新webview-------------------------------------------------------------------------------
            $("#refreshbtn1").click(function () {
                log($(this).text() + " click");
                // reloadWebView();
                window.location.href = window.location.href;
                log($(this).text() + " stop");
            });

            //分享------------------------------------------------------------------------------------
            $("#h5sharebtn").click(function () {
                log($(this).text() + " click");
				var shareData =
				{
						"H5ShareInfo": {
							"MiniProCode": "",
							"PageUrl": "http://m.lifevc.com",
							"ShareDesc": "测试描述",
							"ShareImgUrl": "http://m.lifevc.com",
							"ShareLink": "http://m.lifevc.com",
							"ShareTitle": "测试1",
							"ShareType": 1
						}
					};
                appShareUrl(shareData);
                log($(this).text() + " stop");
            });

			$("#sharebtn").click(function () {
                log($(this).text() + " click");
				var shareData = {
						"H5ShareInfo": {
							"MiniProCode": "",
							"PageUrl": "http://m.lifevc.com",
							"ShareDesc": "测试描述",
							"ShareImgUrl": "http://m.lifevc.com",
							"ShareLink": "http://m.lifevc.com",
							"ShareTitle": "测试1",
							"ShareType": 1
						},
						"ImageShareInfo": {
							"MiniProCode": "",
							"PageUrl": "http://m.lifevc.com",
							"ShareDesc": "有赞",
							"ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
							"ShareLink": "https://h5.youzan.com/v2/showcase/goods?alias=2xj1oooyi7nj3",
							"ShareTitle": "分享有赞",
							"ShareType": 3
						},
						"MiniProShareInfo": {
							"MiniProCode": "gh_37a5a52fcf1e",
							"PageUrl": "http://m.lifevc.com",
							"ShareDesc": "有赞",
							"ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
							"ShareLink": "https://h5.youzan.com/v2/showcase/goods?alias=2xj1oooyi7nj3",
							"ShareTitle": "分享有赞",
							"ShareType": 2
						}
					};
                appShareUrl(shareData);
                log($(this).text() + " stop");
            });



            $("#h5sharebtn1").click(function () {
                log($(this).text() + " click");
                var shareData =
                    {
                        "ShareLink": "http://m.lifevc.com",
                        "ShareTitle": "测试H5分享到朋友圈",
                        "ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
                        "ShareDesc": "测试H5分享到朋友圈描述",
                        "ShareType": 1, //(1、H5 2、海报 3、小程序)
                        "SharePlatform": 1, //(1、朋友圈 2、微信好友 3、QQ)
                    };
                shareItem(shareData);
                log($(this).text() + " stop");
            });
            $("#h5sharebtn2").click(function () {
                log($(this).text() + " click");
                var shareData =
                    {
                        "ShareLink": "http://m.lifevc.com",
                        "ShareTitle": "测试H5分享到微信好友",
                        "ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
                        "ShareDesc": "测试H5分享到微信好友描述",
                        "ShareType": 1, //(1、H5 2、海报 3、小程序)
                        "SharePlatform": 2, //(1、朋友圈 2、微信好友 3、QQ)
                    };
                shareItem(shareData);
                log($(this).text() + " stop");
            });
            $("#h5sharebtn3").click(function () {
                log($(this).text() + " click");
                var shareData =
                    {
                        "ShareLink": "http://m.lifevc.com",
                        "ShareTitle": "测试H5分享到QQ",
                        "ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
                        "ShareDesc": "测试H5分享到QQ描述",
                        "ShareType": 1, //(1、H5 2、海报 3、小程序)
                        "SharePlatform":3, //(1、朋友圈 2、微信好友 3、QQ)
                    };
                shareItem(shareData);
                log($(this).text() + " stop");
            });

            $("#imgsharebtn1").click(function () {
                log($(this).text() + " click");
                var shareData =
                    {
                        "ShareLink": "http://m.lifevc.com",
                        "ShareTitle": "测试海报分享到朋友圈",
                        "ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
                        "ShareDesc": "测试海报分享到朋友圈描述",
                        "ShareType": 2, //(1、H5 2、海报 3、小程序)
                        "SharePlatform": 1, //(1、朋友圈 2、微信好友 3、QQ)
                    };
                shareItem(shareData);
                log($(this).text() + " stop");
            });
            $("#imgsharebtn2").click(function () {
                log($(this).text() + " click");
                var shareData =
                    {
                        "ShareLink": "http://m.lifevc.com",
                        "ShareTitle": "测试海报分享到微信好友",
                        "ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
                        "ShareDesc": "测试海报分享到微信好友描述",
                        "ShareType": 2, //(1、H5 2、海报 3、小程序)
                        "SharePlatform": 2, //(1、朋友圈 2、微信好友 3、QQ)
                    };
                shareItem(shareData);
                log($(this).text() + " stop");
            });
            $("#imgsharebtn3").click(function () {
                log($(this).text() + " click");
                var shareData =
                    {
                        "ShareLink": "http://m.lifevc.com",
                        "ShareTitle": "测试海报分享到QQ",
                        "ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
                        "ShareDesc": "测试海报分享到QQ描述",
                        "ShareType": 2, //(1、H5 2、海报 3、小程序)
                        "SharePlatform":3, //(1、朋友圈 2、微信好友 3、QQ)
                    };
                shareItem(shareData);
                log($(this).text() + " stop");
            });
            $("#minsharebtn").click(function () {
                log($(this).text() + " click");
                var shareData =
                    {
                        "MiniProCode": "gh_37a5a52fcf1e",
                        "ShareLink": "http://m.lifevc.com",
                        "ShareTitle": "测试小程序分享到QQ",
                        "ShareImgUrl": "http://i1.lifevccdn.com/upload/cart/91b548e7aa354847a31309f21d857634.png",
                        "ShareDesc": "测试小程序分享到QQ描述",
                        "ShareType": 3, //(1、H5 2、海报 3、小程序)
                        "SharePlatform":2, //(1、朋友圈 2、微信好友 3、QQ)
                    };
                shareItem(shareData);
                log($(this).text() + " stop");
            });
            //分享-------------------------------------------------------------------------------


            //登录------------------------------------------------------------------------------

            //登录
            $("#loginbtn").click(function () {
                log($(this).text() + " click");
                showLoginPopup();
                log($(this).text() + " stop");
            });

            //用户信息
            $("#getuserinfobtn").click(function () {
                log($(this).text() + " click");
                getUserInfo();
                log($(this).text() + " stop");
            });

            //登录-----------------------------------------------------------------------------

            //------------------------------------支付------------------------------------------
            $("#createpaydatabtn").click(function () {
            	log($(this).text() + " click");
                setInnerTitle("更新titlessssssss");
                log($(this).text() + " stop");
                $.ajax({
                    url: "http://rest-test.lifevc.com/pay/LV201905156560372700/alipay_App",
                    headers: {
                        "Content-Type": "application/json",
                        "ApiToken": "U3lzQXBpfDEyMzhlNTQ5NGRjYjQ3MTJiNDBjZjE4"
                    },
                    success: function (result) {
                        $("#alipaytxt").text(result.InnerData.PayData);
                        log("支付宝支付数据生成" + JSON.stringify(result));
                    },
					fail:function(result){
						log("支付宝支付数据生成失败"+JSON.stringify(result));
					}
                });
                $.ajax({
                    url: "http://rest-test.lifevc.com/pay/LV201905156560372700/wxpay_App",
                    headers: {
                        "Content-Type": "application/json",
                        "ApiToken": "U3lzQXBpfDEyMzhlNTQ5NGRjYjQ3MTJiNDBjZjE4"
                    },
                    success: function (result) {
                        $("#wxpaytxt").text(JSON.stringify(result.InnerData.PayData));
                        log("支微信支付数据生成" + JSON.stringify(result));
                    },
					fail:function(result){
						log("微信支付数据生成失败"+JSON.stringify(result));
					}
                });
            });

            //微信支付
            $("#wxpaybtn").click(function () {
                log($(this).text() + " click");
                try {
                    var json = $("#wxpaytxt").val();
                    if (json == "") {
                        alert("请先生成支付信息");
                        return;
                    }
                    var paydata = {};
                    // JSON.parse(json);
                    paydata = {"timestamp":"1576029862","partnerid":"1234838202","package":"Sign=WXPay","noncestr":"87eb563da309416dbd3d92e08049d93d","sign":"97819B9480F0EF278CD565C4078CEC7D","appid":"wx4708f3e8c475498f","prepayid":"wx11100422317253b95b5892d31441411600"};
                    goPay("WxPay_App", paydata);
                } catch (error) {
                    log("wxgopay error");
                    log(error);
                }

                log($(this).text() + " stop");
            });
            //支付宝支付
            $("#alipaybtn").click(function () {
                log($(this).text() + " click");
                try {
                    var json = $("#alipaytxt").val();
                    if (json == "") {
                        alert("请先生成支付信息");
                        return;
                    }
                    var paydata = json;
                    paydata = "app_id=2016052401436765&biz_content=%7b%22body%22%3a%22%22%2c%22out_trade_no%22%3a%22LV201912113457901564%22%2c%22product_code%22%3a%22QUICK_MSECURITY_PAY%22%2c%22subject%22%3a%22LifeVC%e8%ae%a2%e5%8d%95%e5%8f%b7%ef%bc%9aLV201912113457901564%22%2c%22timeout_express%22%3a%2230m%22%2c%22total_amount%22%3a%22179.00%22%7d&charset=utf-8&format=json&method=alipay.trade.app.pay&notify_url=http%3a%2f%2fpaycallback4app.lifevc.com%2fpay%2falipay_app%2fnotify&sign_type=RSA2&timestamp=2019-12-11+10%3a03%3a43&version=1.0&sign=vTfz0o%2bC4%2fiXu%2ff%2fElIF%2b11RfyzrITTL2ialrKP38jgrYT2OugFWTMCBpg9fhl8crTfl5vVD7uZKJIfNA%2b%2fdEyTB2DPl6xt6YRqQN56wN5D7M3cOTRQcJiA4LdRcyme6AB8%2bHH3A9nLqo3yg9AOmioi8jJy7qOBOpuZ%2b8xkK%2f5mJDgOYef7%2brnU8WQeQ7YtvSAAMSVTe%2bdVZ7OK6DknBnacQxEXyslWCT6gU2I08oLPNFXhmDMjYXeB7DOtHNRozNqordZvI%2b767Hc506oH7fqJ90YC30x2uRcD9H%2bYSj0haEpF9PYVLJHMkB%2bR9UOV2M3iVVv%2bmq2fplDyuCWR6qQ%3d%3d";
                    goPay("Alipay_App", paydata);
                } catch (error) {
                    log("alipaygopay error");
                    log(error);
                }
                log($(this).text() + " stop");
            });
            //---------------------------------------支付--------------------------------------


        });
    </script>
</body>

</html>
