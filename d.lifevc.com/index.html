<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>丽芙家居</title>
    <meta name="apple-itunes-app" content="app-id=961925723,app-clip-bundle-id=com.lifevc.iosApp.Clip"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <script src="./jquery.min.js"></script>

    <script type="text/javascript">

        let isHide = false;
        let isIos = false
        let isAndroid = false
        let androidApp = "lifevc://com.lifevc.shop";
        let androidStore = "http://a.app.qq.com/o/simple.jsp?pkgname=com.lifevc.shop"
        let androidApk = "http://d.lifevc.com/android/android-lifevc-665-release.apk";
        let iosApp = "lifevciosApp://com.lifevc.shop";
        let iosStore = "itms-apps://itunes.apple.com/us/app/li-fu-jia-ju-jia-li-que-xiang/id961925723?mt=8";

        function isWeiXin() {
            if (window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i) == 'micromessenger') {
                return true;
            } else {
                return false;
            }
        }

        function openApp() {

            if (navigator.userAgent.match(/android/i)) {
                isAndroid = true
            }
            if (navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)) {
                isIos = true
            }
            document.addEventListener("visibilitychange", function () {
                isHide = true
            })
            if (iosApp) {
                locationCall(iosApp)
            }
            document.getElementById("bg").onclick = function () {
                isHide = false
                if (isAndroid) {
                    if (isWeiXin()) {
                        locationCall(androidStore)
                    } else {
                        window.setTimeout(function () {
                            if (!isHide) {
                                locationCall(androidApk)
                            }
                        }, 2000)
                        locationCall(androidApp)
                    }
                }
                if (isIos) {
                    locationCall(iosStore)
                }
            }
        }

        function locationCall(url) {
            window.location = (url);
        }
        request();
        function request() {
            let url = 'http://w2api.lifevc.com/wechat/config?url='+encodeURIComponent(window.location.href.split('#')[0])

            $.ajax({
                type:"get",
                url:url,
                async:true,
                headers:{
                    'Content-Type':'application/json;charset=utf8',
                    'ApiToken' : "QWN0QXBpfDZjYXRyZW9mMGpwbzM4ZWI0MElINDY1ZGtsZnVv",
                },
                success:function(res){
                    console.log(res)
                    let data = res.InnerData;
                    configWX(data)
                },error:function(err){
                    console.log(err)
                }
            });
        }
        function configWX(data) {
            wx.config({
                debug: true,
                appId: data.appId,
                nonceStr: data.nonceStr,
                signature: data.signatrue,
                timestamp: data.timestamp,
                jsApiList: [],
                openTagList: ['wx-open-launch-app']
            });
            wx.ready(() => {//微信验证成功会调用该方法
                console.log('微信ready成功')
            });
            wx.error(() => {
                console.log('微信初始化失败')
            })

        }
    </script>
</head>
<body>
<body onload="openApp()">
<div id="bg" class="bg"/>
<wx-open-launch-app
        id="launch-btn"
        appid="wx649fd2d75cb908dd"
        extinfo="your-extinfo"
>
    <div>
        <style>.btn { padding: 12px }</style>
        <button class="btn">App内查看</button>
    </div>
</wx-open-launch-app>
<script>
    var btn = document.getElementById('launch-btn');
    btn.addEventListener('launch', function (e) {
        console.log('success');
    });
    btn.addEventListener('error', function (e) {
        console.log('fail', e.detail);
    });
</script>

</body>
<style>
    body {
        background: #194342;
        margin: 0px;
    }

    .bg {
        width: 100%;
        background-image: url('http://i1.lifevccdn.com//Upload/AppCategoryBanner/0ad81bc4a236444089a991a031fd9584.png');
        background-repeat: no-repeat;
        background-size: 100%;
        padding-top: 177.6%;
    }
</style>
</html>
