<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>丽芙家居</title>
<meta name="apple-itunes-app" content="app-id=961925723"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<script type="text/javascript">

      let isHide = false;
      let isIos = false
      let isAndroid = false
      let androidApp = "lifevc://com.lifevc.shop";
      let androidStore = "http://a.app.qq.com/o/simple.jsp?pkgname=com.lifevc.shop"
      let androidApk = "http://d.lifevc.com/android/android-lifevc-654-release.apk";
      let iosApp = "lifevciosApp://com.lifevc.shop";
      let iosStore = "itms-apps://itunes.apple.com/us/app/li-fu-jia-ju-jia-li-que-xiang/id961925723?mt=8";

      function isWeiXin() {
          if (window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i) == 'micromessenger') {
              return true;
          } else {
              return false;
          }
      }

      function openApp() {
          if (navigator.userAgent.match(/android/i)) {
              isAndroid = true
          }
          if (navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)) {
              isIos = true
          }
          document.addEventListener("visibilitychange", function () {
              isHide = true
          })
        //   if (iosApp) {
        //       locationCall(iosApp)
        //   }
          document.getElementById("bg").onclick = function () {
              isHide = false
              if (isAndroid) {
                  if (isWeiXin()) {
                      locationCall(androidStore)
                  } else {
                      window.setTimeout(function () {
                          if (!isHide) {
                              locationCall(androidApk)
                          }
                      }, 2000)
                      locationCall(androidApp)
                  }
              }
              if (isIos) {
                document.domain = 'douxindong.com';
                var ifr = document.createElement('iframe');
                ifr.src = iosStore;
                // ifr.src = iosApp;
                ifr.style.display = 'none';
                document.body.appendChild(ifr);
                //先为iframe 添加一个 onreadystatechange
                iframe.attachEvent("onreadystatechange", function(){
                //此事件在内容没有被载入时候也会被触发，所以我们要判断状态
                //有时候会比较怪异 readyState状态会跳过 complete 所以我们loaded状态也要判断
                    if(iframe.readyState === "complete" || iframe.readyState == "loaded"){
                        //代码能执行到这里说明已经载入成功完毕了
                        //要清除掉事件
                        alert("complete,loaded")
                        iframe.detachEvent( "onreadystatechange", arguments.callee);
                        //这里是回调函数
                    }else{
                        alert("fail")
                    }
                });


                // ifr.onload = function(){
                //     let doc = ifr.contentDocument || ifr.contentWindow.document;
                //     // 在这里操纵b.html
                //     alert(doc)
                // };
                // alert(JSON.stringify(ifr))
                //   locationCall(iosStore)
              }
          }
      }

      function locationCall(url) {
          window.location = url;
      }
  </script>
</head>
<body onload="openApp()">
    <div>3</div>
<div id="bg" class="bg"/>
</body>
<style>
  body {
    background: #194342;
    margin: 0px;
  }

  .bg {
    width: 100%;
    background-image: url('http://i1.lifevccdn.com/images/download/nnnn0.jpg');
    background-repeat: no-repeat;
    background-size: 100%;
    padding-top: 177.6%;
  }
</style>
</html>
